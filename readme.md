# BLS Signature Aggregation Sample

This is a repository for creating sample code to perform "BLS signature aggregation" using
[herumi/bls-eth-go-binary](https://github.com/herumi/bls-eth-go-binary).

Signature aggregation is the aggregation of multiple signatures, generated by multiple private keys, into a single signature. The aggregated signature can be verified using multiple public keys that are pairs of the private keys that generate the signature. In addition, BLS public keys can aggregate multiple public keys.

See [main.go](main/main.go) for the specific code. The following is the result of the execution.

<details><summary>â–¶ $ go test -bench . -benchmem</summary>
<p>

```
% go test -bench . -benchmem                                     
goos: darwin
goarch: amd64
pkg: github.com/herumi/bls-eth-go-binary
BenchmarkBLS/Key-Pair_Generation-8   	    8041	    159027 ns/op	     320 B/op	       2 allocs/op
BenchmarkBLS/Sign-8                  	    5258	    237049 ns/op	     176 B/op	       2 allocs/op
BenchmarkBLS/Verify-8                	    1030	   1150701 ns/op	      32 B/op	       1 allocs/op
[BLS] private key: 32 bytes, public key: 96 bytes, signature: 48 bytes
BenchmarkEd25519/Key-Pair_Generation-8         	   24636	     48917 ns/op	     128 B/op	       3 allocs/op
BenchmarkEd25519/Sign-8                        	   23485	     48897 ns/op	     448 B/op	       5 allocs/op
BenchmarkEd25519/Verify-8                      	    8696	    129727 ns/op	     288 B/op	       2 allocs/op
[Ed25519] private key: 64 bytes, public key: 32 bytes, signature: 64 bytes
BenchmarkECDSA/Key-Pair_Generation-8           	   79927	     14742 ns/op	     608 B/op	      12 allocs/op
BenchmarkECDSA/Sign-8                          	   46844	     24362 ns/op	    2673 B/op	      32 allocs/op
BenchmarkECDSA/Verify-8                        	   15489	     73547 ns/op	     880 B/op	      16 allocs/op
[ECDSA] private key: 96 bytes, public key: 64 bytes, signature: 64 bytes
BenchmarkBLSSignatureAggregation/Signatures_Aggregation[1]-8         	11921097	        99.9 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Signatures_Aggregation[2]-8         	  858780	      1398 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Signatures_Aggregation[4]-8         	  150889	      7968 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Signatures_Aggregation[10]-8        	   21208	     54865 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Signatures_Aggregation[21]-8        	    4713	    264312 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Signatures_Aggregation[46]-8        	     834	   1405285 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Signatures_Aggregation[100]-8       	     182	   7263944 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[1]-8         	     996	   1180856 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[2]-8         	    1008	   1173365 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[4]-8         	    1021	   1160625 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[10]-8        	     991	   1189269 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[21]-8        	    1034	   1182553 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[46]-8        	    1014	   1254598 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[100]-8       	     874	   1412549 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Public_Keys_Aggregation[1]-8                   	 9616620	       131 ns/op	     288 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Public_Keys_Aggregation[2]-8                   	  619616	      1883 ns/op	     288 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Public_Keys_Aggregation[4]-8                   	  227913	      5211 ns/op	     288 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Public_Keys_Aggregation[10]-8                  	   77144	     15517 ns/op	     288 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Public_Keys_Aggregation[21]-8                  	   34710	     34714 ns/op	     288 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Public_Keys_Aggregation[46]-8                  	   14841	     82380 ns/op	     288 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Public_Keys_Aggregation[100]-8                 	    6742	    186919 ns/op	     288 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[1]_by_Aggregated_Public_Key-8         	     949	   1160103 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[2]_by_Aggregated_Public_Key-8         	    1086	   1173561 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[4]_by_Aggregated_Public_Key-8         	    1026	   1171737 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[10]_by_Aggregated_Public_Key-8        	    1052	   1139920 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[21]_by_Aggregated_Public_Key-8        	    1076	   1135123 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[46]_by_Aggregated_Public_Key-8        	    1053	   1153195 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/Aggregated_Signature_Verification[100]_by_Aggregated_Public_Key-8       	    1016	   1154050 ns/op	      32 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/AggregateSigsForDiffMsg[1]-8                                            	11009790	       110 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/AggregateSigsForDiffMsg[2]-8                                            	 1569790	       781 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/AggregateSigsForDiffMsg[4]-8                                            	  594244	      2187 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/AggregateSigsForDiffMsg[10]-8                                           	  195490	      6136 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/AggregateSigsForDiffMsg[21]-8                                           	   88959	     13435 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/AggregateSigsForDiffMsg[46]-8                                           	   39386	     31180 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/AggregateSigsForDiffMsg[100]-8                                          	   17497	     67921 ns/op	     144 B/op	       1 allocs/op
BenchmarkBLSSignatureAggregation/VerifyAggrSigsForDiffMsg[1]-8                                           	     975	   1235303 ns/op	      64 B/op	       2 allocs/op
BenchmarkBLSSignatureAggregation/VerifyAggrSigsForDiffMsg[2]-8                                           	     734	   1689306 ns/op	      96 B/op	       2 allocs/op
BenchmarkBLSSignatureAggregation/VerifyAggrSigsForDiffMsg[4]-8                                           	     502	   2532615 ns/op	     160 B/op	       2 allocs/op
BenchmarkBLSSignatureAggregation/VerifyAggrSigsForDiffMsg[10]-8                                          	     229	   5027552 ns/op	     352 B/op	       2 allocs/op
BenchmarkBLSSignatureAggregation/VerifyAggrSigsForDiffMsg[21]-8                                          	     100	  10062170 ns/op	     736 B/op	       2 allocs/op
BenchmarkBLSSignatureAggregation/VerifyAggrSigsForDiffMsg[46]-8                                          	      61	  20729502 ns/op	    1568 B/op	       2 allocs/op
BenchmarkBLSSignatureAggregation/VerifyAggrSigsForDiffMsg[100]-8                                         	      26	  45723012 ns/op	    3232 B/op	       2 allocs/op
PASS
ok  	github.com/herumi/bls-eth-go-binary	72.241s
```

</p>
</details>

In aggregated signature and public key, I generated 10 key-pairs, created 10 signatures for one message, and aggregated them into a single signature. It's able to verify the aggregated signature using 10 public keys or one public key that aggregates them.

The order in which signatures are aggregated and the order of public keys has no effect on verification.

## Key and Signature Size Comparison

| Data | BLS | BLS (ETH) | Ed25519 | ECDSA (p256) |
|:-----|----:|----------:|--------:|-------------:|
| Private Key | 32 bytes | 32 bytes | 64 bytes | 96 bytes |
| Public Key | 96 bytes | 48 bytes | 32 bytes | 64 bytes |
| Signature | 48 bytes | 96 bytes | 64 bytes | 64 bytes |
| Aggregated Signature | 48 bytes | 96 bytes | - | - |
| Aggregated Public Key | 96 bytes | 48 bytes | - | - |

The table above shows that aggregated public key and aggregated signature have the same size as regular public key and signature.

## Comparison with other elliptic-curve cryptography

Follows are the execution times for 1) key-pair generation, 2) signing with a single private key, and 3) verifying a single signature with a single public key by [bls_test.go](https://github.com/torao/sample.bls-signature-aggregation/blob/master/bls_test.go):

| | BLS | Ed25519 | ECDSA (p256) |
|:----------------|-------------:|----------:|----------:|
| Key-Pair Generation | 73,486ns            | 46,336ns | 14,711ns |
| Sign                   | 552,673ns     | 47,036ns           | 23,724ns          |
| Verify                 | 1,386,782ns | 124,300ns            | 69,779ns          |

BLS signature is faster than ed25519 and ECDSA in generating key-pair but takes longer to sign and verify.

## Execution times relative to the number of keys and signatures

The time for signatures and public keys aggregation increases in proportion to their number. However, the verification for the aggregated signature is completed in constant time.

![2021-03-29 macOS i7 2.8GHz](https://user-images.githubusercontent.com/836654/112778933-9a11bf00-9080-11eb-914d-8641a3479caf.png)
